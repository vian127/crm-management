<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="format-detection" content="telephone=no">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <link rel="stylesheet" href="css/base.css" />
        <link rel="stylesheet" href="css/main.css" />
        <script src="js/jquery-2.1.4.min.js" ></script>
    </head>
    <body>
            <!-- 作品详情 -->
            <div class="page">
                <div class="content1">
                    <!-- 头部信息 -->
                    <div class="personnel_detail" style="margin-top: 1em">
                        <h1 class="font11">如何最便捷去除指甲油<span class="w_color8" style="margin-left: 0.5em">推荐</span><span class="font08 f_r">2015.08.29</span></h1>
                        <img src="images/13.png" alt="头像"/>
                        <div style="width:auto;">
                            <span>小美</span><br/>
                            <span class="w_color11">财富值</span><span class="w_color3">300</span>
                        </div>
                        <!-- 关注 -->
                        <a class="btn2 btn_type8 js_btn6" href="javascript:;" title="关注">+关注</a>

                        <!-- 分享 -->
                        <a class="btn1 btn_type3 js_btn1 share_btn" href="javascript:;" title="分享"><img src="images/15.png" alt="分享"/></a>
                        <!-- 收藏 -->
                        <a class="btn1 btn_type3 js_btn2" href="javascript:;" title="收藏"><img src="images/14.png" alt="收藏"/></a>
                    </div>
                    <img src="images/2.jpg" alt="作品图片"/>
                    <p>最新作品，浪漫清新，希望大家喜欢！</p>
                    <!-- 评论 -->
                    <div class="clear">
                        <!-- 评论 -->
                        <a class="btn1 btn_type9 js_btn7" href="javascript:;" title="评论"><img src="images/22.png" alt="评论"/><span style="vertical-align: top;" class="w_color3">151</span></a>
                        <!-- 赞 -->
                        <a class="btn1 btn_type9 js_btn8" href="javascript:;" title="赞"><img src="images/23.png" alt="赞"/><span class="w_color3">85</span></a>
                    </div>
                    <h3 class="review_h3">精彩评论</h3>
                    <!-- 用户评论列表 -->
                    <ul class="review_list">
                        <li class="clear">
                            <!-- 头像 -->
                            <div class="pic_div1"><img class="header_pic" src="images/13.png"></div>
                            <!-- 内容 -->
                            <div class="txt_div">
                                <!-- 昵称 -->
                                <span class="font12 name_spn">之乎者也</span><br>
                                <!-- 时间 -->
                                <span class="review_date_spn">2015年6月15日</span><br/>
                                <!-- 内容 -->
                                <span class="font12 js_txt">听说资生堂正在搞活动，走起的速度的！</span>
                                <!-- 评论按钮 -->
                                <div class="review_spn">
                                    <span class="font08">沙发</span><br>
                                    <img src="images/24.png" alt="评论"/>
                                </div>
                            </div>
                        </li>
                        <li class="clear">
                            <!-- 头像 -->
                            <div class="pic_div1"><img class="header_pic" src="images/3.png"></div>
                            <!-- 内容 -->
                            <div class="txt_div">
                                <!-- 昵称 -->
                                <span class="font12 name_spn">妈妈咪呀</span><br>
                                <!-- 时间 -->
                                <span class="review_date_spn">2015年9月03日</span><br/>
                                <!-- 内容 -->
                                <span class="font12">回复</span><span class="w_color3 font12">@之乎者也:</span><span class="font12 js_txt">真好，一起走起！</span>
                                <!-- 评论按钮 -->
                                <div class="review_spn">
                                    <span class="font08">板凳</span><br>
                                    <img src="images/24.png" alt="评论"/>
                                </div>
                                <!-- 被评论者内容 -->
                                <div class="reviewer">
                                    <span class="w_color3 font12">@之乎者也:</span><span class="font12">真好，一起走起！</span>
                                </div>
                            </div>
                        </li>
                        <li class="clear">
                            <!-- 头像 -->
                            <div class="pic_div1"><img class="header_pic" src="images/1.png"></div>
                            <!-- 内容 -->
                            <div class="txt_div">
                                <!-- 昵称 -->
                                <span class="font12 name_spn">我勒个去</span><br>
                                <!-- 时间 -->
                                <span class="review_date_spn">2015年9月15日</span><br/>
                                <!-- 内容 -->
                                <span class="font12 js_txt">听说资生堂正在搞活动，走起的速度的！</span>
                                <!-- 评论按钮 -->
                                <div class="review_spn">
                                    <span class="font08">沙发</span><br>
                                    <img src="images/24.png" alt="评论"/>
                                </div>
                            </div>
                        </li>
                        <li>4</li>
                        <li>5</li>
                        <li>6</li>
                        <li>7</li>
                        <li>8</li>
                        <li>9</li>
                        <li>10</li>
                        <li>11</li>
                        <li>12</li>
                        <li>13</li>
                    </ul>
                    <div class="add_more">
                        <!-- 点击加载更多的时候，后台读取数据并append到class=review_list  里边 -->
                        <a class="add_more_btn btn1" href="javascript:;" title="查看更多">查看更多</a>
                    </div>
                </div>
            </div>
        <!-- 评论框 -->
        <div class="input_box">
            <input id="type_input" type="hidden" data-type="1" value=""/>
            <input class="content_input" type="text" placeholder="回复王者归来:"/>
            <input class="submit_btn" type="button" value="发送"/>
            <div class="sty_div"></div>
        </div>
        <!-- 背景 -->
        <div class="bg_div"></div>
        <!-- 分享弹框 -->
        <div class="fixed_div share_box">
            <h2>分享</h2>
            <a class="btn1 js_btn3" href="javascript:;"><img src="images/19.png" alt="icon"><span>朋友圈</span></a>
            <a class="btn1 js_btn4" href="javascript:;"><img src="images/20.png" alt="icon"><span>QQ空间</span></a>
            <a class="btn1 js_btn5" href="javascript:;"><img src="images/21.png" alt="icon"><span>新浪微博</span></a>
        </div>
        <!-- 浮层 -->
        <div id="fix_box">
            <!-- 占位 -->
            <div id="placeholder_div"></div>
            <!-- 背景 -->
            <div id="bg_div"></div>
            <!-- 提示 -->
            <div id="tip_txt">我勒个去啊啊</div>
        </div>
        <script type="text/javascript">
            //调整布局
            $(function(){rs();});
                $(window).resize(function(){rs();});
            var rs=function(){
                var dw=document.documentElement.clientWidth;
                var dh=document.documentElement.clientHeight;
                $("body").css({"font-size":1*dw/360+"em"});
            }
            $(function(){
                // 点击加载更多
                (function(){
                    // 页面加载显示数量
                    var list_len=$(".review_list>li").length;
                    if(list_len>3){
                        $(".review_list>li:gt(2)").hide();
                        $(".add_more").show();
                    }else{
                        $(".add_more").hide();
                    }
                    // 默认每次添加10条
                    var num=0;
                    $(".add_more_btn").on("click",function(){
                        var list_len=$(".review_list>li").length;
                        if(list_len>num && num-list_len<=10){
                            num+=10;
                            $(".review_list>li:lt("+num+")").show();
                            
                        }else{
                            $(this).text("没有更多内容");
                            num=null;
                        }
                    });
                })();
                // 后台读取用户的昵称和头像路径放在对应的arr里边
                var arr={"name":"奥拉","pic_src":"1.jpg"}
                $(document).on("click",".submit_btn",function(){
                    var type=$(this).siblings("#type_input").attr("data-type");
                    reviewFunc($(this),arr,type);
                });
                // 评论他人
                $(document).on("click",".review_spn",function(){
                    $(".js_now").removeClass("js_now");
                    $(this).parent().parent("li").addClass("js_now");
                    toReview($(this),2);
                });
                // 取消评论
                $(".container").on("click",function(){
                    $(".content_input").parent().hide();
                });
                // 评论
                $(".js_btn7").on("click",function(){
                    $(".js_now").removeClass("js_now");
                    $(this).parent().parent("li").addClass("js_now");
                    toReview($(this),1);
                });
                // 赞
                $(".js_btn8").on("click",function(){
                    var num=$(this).children("span").text();
                    if(num!="" || num!=null){
                        num=parseInt(num)+1;
                        $(this).children("span").text(num);
                        $(".js_btn8").off("click");
                    }
                });
                // 关注、取消
                $(".js_btn6").on("click",function(){
                    if(!$(this).hasClass("js_gz")){
                        $(this).addClass("js_gz").text("已关注");
                    }else{
                        $(this).removeClass("js_gz").text("+关注");
                    }
                });
                  // 分享弹框
                $(".js_btn1").on("touchend",function(){
                    $(".share_box").fadeIn();
                    $(".bg_div").fadeIn();
                });
                // 分享到朋友圈
                $(".js_btn3").on("touchend",function(){
                    $(this).parent().fadeOut();
                    $(".bg_div").fadeOut();
                });
                // 分享到QQ空间
                $(".js_btn4").on("touchend",function(){
                    $(this).parent().fadeOut();
                    $(".bg_div").fadeOut();
                });
                // 分享到新浪微博
                $(".js_btn5").on("touchend",function(){
                    $(this).parent().fadeOut();
                    $(".bg_div").fadeOut();
                });
                
                // 收藏
                $(".js_btn2").on("touchend",function(){
                    if(!$(this).hasClass("js_now")){
                        $(this).addClass("js_now");
                        to_prompt.at("收藏成功");
                    }else{
                        $(this).removeClass("js_now");
                        to_prompt.at("取消收藏");
                    }
                });
            });
            // 浮框提示
            var to_prompt={
                // 外框id
                box_obj: document.getElementById("fix_box"),
                // 占位框id
                place_obj: document.getElementById("placeholder_div"),
                // 文本框id
                txt_obj: document.getElementById("tip_txt"),
                // 居中计算
                toCenter:function(parent_ele,obj){
                    var fw=parent_ele==document?document.documentElement.clientWidth:parent_ele.offsetWidth;
                    var fh=parent_ele==document?document.documentElement.clientHeight:parent_ele.offsetHeight;
                    var ow=obj.offsetWidth;
                    var oh=obj.offsetHeight;
                    obj.style.left=(fw-ow)/2+"px";
                    obj.style.top=(fh-oh)/2+"px";
                },
                getEle:function(){
                    this.place_obj.style.height=this.txt_obj.offsetHeight+"px";
                    this.toCenter(document,this.box_obj);
                    this.toCenter(this.box_obj,this.txt_obj);
                },
                toPrompt:function(txt){
                    var a=this.box_obj;
                    this.txt_obj.innerHTML=txt;
                    a.style.display="inline-block";
                    setTimeout(function(){
                        a.style.display="none";
                    },1000);
                },
                at:function(txt){
                    this.toPrompt(txt);
                    this.getEle();
                }
            }
                // 评论其他评论 type=1是评论内容 type=2评论他人
                function toReview(obj,type){
                    var name=obj.siblings(".name_spn").text();
                    var _index=$(".review_spn").index(obj);
                    $(".content_input").parent().show();
                    if($("#type_input").val()!=_index){
                        $(".content_input").val("");
                    }
                    if(type==1){
                        $(".content_input").focus().attr("placeholder","评论");
                    }else if(type==2){
                        $(".content_input").focus().attr("placeholder",name);
                    }
                    $("#type_input").val(_index).attr("data-type",type);
                }
                // 发布评论
                function reviewFunc(obj,arr,type){
                    var txt=obj.siblings(".content_input").val();
                    var _html=null;
                    // 评论时间  如果后台读取的话直接给我一个数据  例如 2015年8月30日
                    var today_str="";
                    var t=new Date();
                    var y=t.getFullYear();
                    var m=t.getMonth()+1;
                    var d=t.getDate();;
                    today_str=y+"年"+m+"月"+d+"日";
                    if(txt=="" || txt==null){
                        to_prompt.at("请先填写发布内容！");
                    }else{
                        // 取消点击事件
                        $(".submit_btn").off("click");
                        $(this).text("发布中");
                        if(type==1){
                            // 评论内容
                            _html='<li class="clear"><div class="pic_div1"><img class="header_pic" src="images/'+arr.pic_src+'"></div><div class="txt_div"><span class="font12 name_spn">'+arr["name"]+'</span><br><span class="review_date_spn">'+today_str+'</span><br/><span class="font12 js_txt">'+txt+'</span><div class="review_spn"><span class="font08">沙发</span><br><img src="images/24.png" alt="评论"/></div></div></li>';
                        }else if(type==2){
                            var name=obj.siblings(".content_input").attr("placeholder");
                            var review_txt=$(".js_now").children(".txt_div").children(".js_txt").text();
                            // 评论其他人的评论
                            _html='<li class="clear"><div class="pic_div1"><img class="header_pic" src="images/'+arr.pic_src+'"></div><div class="txt_div"><span class="font12 name_spn">'+arr["name"]+'</span><br><span class="review_date_spn">'+today_str+'</span><br/><span class="font12">回复</span><span class="w_color3 font12">@'+name+':</span><span class="font12 js_txt">'+txt+'</span><div class="review_spn"><span class="font08">板凳</span><br><img src="images/24.png" alt="评论"/></div><div class="reviewer"><span class="w_color3 font12">@'+name+':</span><span class="font12">'+review_txt+'</span></div></div></li>';
                        }
                        $(".review_list").prepend(_html);
                        obj.parent().hide();
                        $(".submit_btn").on("click",function(){
                            var type=$(this).siblings("#type_input").attr("data-type");
                            reviewFunc($(this),arr,type);
                        });
                    }
                }
        </script>
    </body>
</html>