<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport" content="width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <meta charset="author" content="we"/>
    <meta name="keywords" content="Dior迪奥美妆部"/>
    <meta name="description" content="Dior迪奥美妆部"/>
    <title>Dior</title>
    <link rel="stylesheet" type="text/css" href="css/swiper3.08.min.css"/>
    <link rel="stylesheet" type="text/css" href="css/main.css"/>
    <script type="text/javascript" src="js/jquery-2.1.4.min.js"></script>
</head>
<body>
    <section id="container">
        <section id="header">
            <h1>管理员页面</h1>
        </section>
        <section id="content" class="page10">
            <!-- 滚动 -->
                <div class="p10_top_div">
                    <h4>请在下方筛选您想查看的员工</h4>
                    <label>姓名：</label>
                    <input class="input_area input1" type="text" placeholder="输入姓名">
                    <label class="p10_label1">工号：</label>
                    <input class="input_area input2" type="text" placeholder="输入工号"><br/>
                    <label>区域：</label>
                    <select class="sele1 js_select1">
                        <option disabled>请选择</option>
                    </select>
                    <label class="p10_label1">城市：</label>
                    <select class="sele2">
                        <option disabled>请选择</option>
                    </select><br/>
                    <label>柜台：</label>
                    <select class="sele3">
                        <option disabled>请选择</option>
                    </select>
                    <a class="btn1" href="javascript:;" title="确认">确认</a>
                    
                </div>
                <img class="p10_pic1" src="images/line3.png" alt="分割线">
                <div class="p10_content">
                    <!-- 浮层 -->
                    <div class="p10_div1 p10_box">

                        <h3>请点击您想看的员工页面</h3>
                        <a class="btn1 js_detail_btn" href="javascript:;" data-type="1" data-src="monthlyindex.html" title="我的表现GoldenBC">我的表现GoldenBC</a><br/>
                        <a class="btn1 js_detail_btn" href="javascript:;" data-type="2" data-src="single_detail.html" title="我的表现单项">我的表现单项</a><br/>
                        <a class="btn1 js_detail_btn" href="javascript:;" data-type="1" data-src="mygrowthindex.html" title="我的成长">我的成长</a><br/>
                        <a class="btn1 js_detail_btn" href="javascript:;" data-type="2" data-src="member_detail.html" title="我的CRM会员详情">我的CRM会员详情</a><br/>
                        <a class="btn1 js_close_btn" href="javascript:;" title="关闭">关闭</a>
                    </div>
                    <!-- 遮罩 -->
                    <div class="p10_bg p10_box"></div>
                    <div class="scroll_box">
                        <!-- 列表 -->
                        <ul class="p10_list">
                            <li>
                                <span class="icon_spn1">&nbsp;</span>
                                <label>姓名：</label>
                                <span>柳青</span>
                                <label class="p10_lab1">工号：</label>
                                <span>D2565</span>
                                <a class="btn2 f_r js_show_btn" href="javascript:;" title="查看详情">查看详情</a>
                            </li>
                            <li>
                                <span class="icon_spn1">&nbsp;</span>
                                <label>姓名：</label>
                                <span>柳青</span>
                                <label class="p10_lab1">工号：</label>
                                <span>D2565</span>
                                <a class="btn2 f_r js_show_btn" href="javascript:;" title="查看详情">查看详情</a>
                            </li>
                            <li>
                                <span class="icon_spn1">&nbsp;</span>
                                <label>姓名：</label>
                                <span>柳青</span>
                                <label class="p10_lab1">工号：</label>
                                <span>D2565</span>
                                <a class="btn2 f_r js_show_btn" href="javascript:;" title="查看详情">查看详情</a>
                            </li>
                            <li>
                                <span class="icon_spn1">&nbsp;</span>
                                <label>姓名：</label>
                                <span>柳青</span>
                                <label class="p10_lab1">工号：</label>
                                <span>D2565</span>
                                <a class="btn2 f_r js_show_btn" href="javascript:;" title="查看详情">查看详情</a>
                            </li>
                            <li>
                                <span class="icon_spn1">&nbsp;</span>
                                <label>姓名：</label>
                                <span>柳青</span>
                                <label class="p10_lab1">工号：</label>
                                <span>D2565</span>
                                <a class="btn2 f_r js_show_btn" href="javascript:;" title="查看详情">查看详情</a>
                            </li>
                            <li>
                                <span class="icon_spn1">&nbsp;</span>
                                <label>姓名：</label>
                                <span>柳青</span>
                                <label class="p10_lab1">工号：</label>
                                <span>D2565</span>
                                <a class="btn2 f_r js_show_btn" href="javascript:;" title="查看详情">查看详情</a>
                            </li>
                            <li>
                                <span class="icon_spn1">&nbsp;</span>
                                <label>姓名：</label>
                                <span>柳青</span>
                                <label class="p10_lab1">工号：</label>
                                <span>D2565</span>
                                <a class="btn2 f_r js_show_btn" href="javascript:;" title="查看详情">查看详情</a>
                            </li>
                            <li>
                                <span class="icon_spn1">&nbsp;</span>
                                <label>姓名：</label>
                                <span>柳青</span>
                                <label class="p10_lab1">工号：</label>
                                <span>D2565</span>
                                <a class="btn2 f_r js_show_btn" href="javascript:;" title="查看详情">查看详情</a>
                            </li>
                            <li>
                                <span class="icon_spn1">&nbsp;</span>
                                <label>姓名：</label>
                                <span>柳青</span>
                                <label class="p10_lab1">工号：</label>
                                <span>D2565</span>
                                <a class="btn2 f_r js_show_btn" href="javascript:;" title="查看详情">查看详情</a>
                            </li>
                            <li>
                                <span class="icon_spn1">&nbsp;</span>
                                <label>姓名：</label>
                                <span>柳青</span>
                                <label class="p10_lab1">工号：</label>
                                <span>D2565</span>
                                <a class="btn2 f_r js_show_btn" href="javascript:;" title="查看详情">查看详情</a>
                            </li>
                            <li>
                                <span class="icon_spn1">&nbsp;</span>
                                <label>姓名：</label>
                                <span>柳青</span>
                                <label class="p10_lab1">工号：</label>
                                <span>D2565</span>
                                <a class="btn2 f_r js_show_btn" href="javascript:;" title="查看详情">查看详情</a>
                            </li>

                            <li>
                                <span class="icon_spn1">&nbsp;</span>
                                <label>姓名：</label>
                                <span>柳青</span>
                                <label class="p10_lab1">工号：</label>
                                <span>D2565</span>
                                <a class="btn2 f_r js_show_btn" href="javascript:;" title="查看详情">查看详情</a>
                            </li>
                            <li>
                                <span class="icon_spn1">&nbsp;</span>
                                <label>姓名：</label>
                                <span>柳青</span>
                                <label class="p10_lab1">工号：</label>
                                <span>D2565</span>
                                <a class="btn2 f_r js_show_btn" href="javascript:;" title="查看详情">查看详情</a>
                            </li>
                        </ul>
                        <!-- 提示 -->
                        <p class="js_no_person">没有匹配的人员。</p>
                    </div>
                </div>
        </section>
        <!-- 查看窗口 -->
        <section id="iframe_window">
            <a class="btn1 js_close_window" href="javascript:;" title="关闭">关闭</a>
            <iframe id="iframe_ele" src="monthlyindex.html"></iframe>
        </section>
    </section>
    <!-- 提示 -->
    <div id="atten_box" class="center_box">
        <div id="atten_txt">请填写问题内容！</div>
        <div class="bg_div"></div>
    </div>
    <script type="text/javascript" src="js/iscroll.js"></script>
    <script type="text/javascript">
        var data=[{"id":"3","name":"\u9646\u658c","userid":"lubin","counter":"\u5929\u6d25\u53cb\u8c0a","area":"\u4e0a\u6d77","city":"\u4e0a\u6d77","is_admin":"1","leader":"wangmingqing,chijie,lubin,liuqing,chejiulong","created":"2016-04-06 10:16:22","modified":"2016-04-06 10:16:22","avatar":"http:\/\/shp.qpic.cn\/bizmp\/kGSt7UEHXs3KicKMW9byvByLgjdxQDGiakjE0eHcR3IAFD0vAKWcAoKw\/"},{"id":"4","name":"\u8f66\u4e45\u9f99","userid":"chejiulong","counter":"\u5929\u6d25\u4f0a\u52bf\u4e39","area":"\u4e0a\u6d77","city":"\u4e0a\u6d77","is_admin":"1","leader":"wangmingqing,chijie,lubin,liuqing","created":"2016-04-06 10:16:22","modified":"2016-04-06 10:16:22","avatar":"http:\/\/shp.qpic.cn\/bizmp\/kGSt7UEHXs2cVQOgmadC1WEMcqtyoMkibJlwuusYwsmSYBwiaaUkcib7g\/"},{"id":"5","name":"\u67f3\u9752","userid":"liuqing","counter":"\u6c88\u9633\u4e2d\u5174","area":"\u4e0a\u6d77","city":"\u4e0a\u6d77","is_admin":"1","leader":"wangmingqing,chijie,lubin,liuqing,chejiulong","created":"2016-04-06 10:16:22","modified":"2016-04-06 10:16:22","avatar":"http:\/\/shp.qpic.cn\/bizmp\/kGSt7UEHXs3F0b01DYoU3CqXYqdr04iahHJJFpwYPAe7PyvR6WMjlPw\/"},{"id":"6","name":"\u5f90\u6bd5\u51e1","userid":"xubifan","counter":"\u5929\u6d25\u53cb\u8c0a","area":"\u4e0a\u6d77","city":"\u4e0a\u6d77","is_admin":"2","leader":"wangmingqing,chijie,lubin,liuqing,chejiulong","created":"2016-04-06 10:16:22","modified":"2016-04-06 10:16:22","avatar":"http:\/\/shp.qpic.cn\/bizmp\/kGSt7UEHXs1ZOZIXDWmd0m4nJ42o0zN60eWthKbqOQuibGXafmfxicqA\/"},{"id":"7","name":"\u6881\u8f89","userid":"lianghui","counter":"\u957f\u6625\u5353\u5c55","area":"\u4e0a\u6d77","city":"\u4e0a\u6d77","is_admin":"2","leader":"wangmingqing,chijie,lubin,liuqing,chejiulong","created":"2016-04-06 10:16:22","modified":"2016-04-06 10:16:22","avatar":"http:\/\/shp.qpic.cn\/bizmp\/kGSt7UEHXs0QcO0AID6gGnnY4xricaka5yHascLb0pFYguvZSwlNiaUw\/"},{"id":"8","name":null,"userid":null,"counter":"\u957f\u6625\u6b27\u4e9a","area":"\u4e0a\u6d77","city":"\u4e0a\u6d77","is_admin":"2","leader":"wangmingqing,chijie,lubin,liuqing","created":"2016-04-06 10:16:22","modified":"2016-04-06 10:16:22","avatar":null},{"id":"9","name":null,"userid":null,"counter":"\u957f\u6625\u6b27\u4e9a","area":"\u4e0a\u6d77","city":"\u4e0a\u6d77","is_admin":"2","leader":"wangmingqing,chijie,lubin,liuqing","created":"2016-04-06 10:16:22","modified":"2016-04-06 10:16:22","avatar":null},{"id":"10","name":null,"userid":null,"counter":"\u5317\u4eac\u7fe0\u5fae","area":"\u4e0a\u6d77","city":"\u4e0a\u6d77","is_admin":"2","leader":"wangmingqing,chijie,lubin,liuqing","created":"2016-04-06 10:16:22","modified":"2016-04-06 10:16:22","avatar":null},{"id":"11","name":null,"userid":null,"counter":"\u77f3\u5bb6\u5e84\u5317\u56fd","area":"\u4e0a\u6d77","city":"\u4e0a\u6d77","is_admin":"2","leader":"wangmingqing,chijie,lubin,liuqing","created":"2016-04-06 10:16:22","modified":"2016-04-06 10:16:22","avatar":null},{"id":"12","name":null,"userid":null,"counter":"\u957f\u6625\u6b27\u4e9a","area":"\u4e0a\u6d77","city":"\u4e0a\u6d77","is_admin":"2","leader":"wangmingqing,chijie,lubin,liuqing","created":"2016-04-06 10:16:22","modified":"2016-04-06 10:16:22","avatar":null}];
        // 定义滚动
        var myScroll = new IScroll('.scroll_box',
            { 
                mouseWheel: true,
                hideScrollbar: true,
                click: true
            }
        );
        // 返回数组对象
        var return_arr={};
        // 自定义方法
        var $m={
            // 字体设置
            rs: function(){
                var limit=720;
                var dw=document.documentElement.clientWidth;
                var dh=document.documentElement.clientHeight;
                var fw=dw>limit?limit:dw;
                $("body").css({"font-size":1*fw/360+"em"});
                var ratio=1;
                if(dh/fw*720<1136){
                    ratio=dh/fw*720/1136;
                }
                if(dw>limit){
                    $(".center_box").css({"left":(dw-limit)/2+"px"});
                };
                var oh=$(".p10_div1").height();
                $(".p10_bg").height(oh+"px");
                myScroll.refresh()
            },
            ajax_link:"http://givenchy.weshwx.cn/dior_golden_bc/get_user",
            area_arr:[],                                        //区域
        }
        var nSearch=null;
        var link_obj=GetRequest();
        var userid=link_obj["userid"]?link_obj["userid"]:"";
        // var rt_type=link_obj["rt_type"]?link_obj["rt_type"]:2;
        // 获取页面url数据
        function GetRequest(){ 
            var url = location.search; //获取url中"?"符后的字串 
            var theRequest = new Object(); 
            if (url.indexOf("?") != -1) { 
                var str = url.substr(1); 
                strs = str.split("&"); 
                for(var i = 0; i < strs.length; i ++) { 
                    theRequest[strs[i].split("=")[0]]=unescape(strs[i].split("=")[1]); 
                }
            } 
            return theRequest; 
        };
        // ajxa请求地址
        $(function(){
            //禁止分享 
            if (typeof WeixinJSBridge == "undefined"){
                if( document.addEventListener ){
                    document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);
                }else if (document.attachEvent){
                    document.attachEvent('WeixinJSBridgeReady', onBridgeReady); 
                    document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);
                }
            }else{
                onBridgeReady();
            };
            $m.rs();
            nSearch=new selMethod();
            // 请求人员信息
            // getDom();
            setDom(data);
            // 区域选择联动
            $(document).on("change",".js_select1",function(){
                var txt=$(this).val()?$(this).val():"";
                if(txt!=""){
                    var data=$m.data_arr;
                    var aaa=nSearch.searchFunc({"area":txt},data,"city",$(".js"));
                    console.log(aaa);
                }
            });
            // 查看框
            $(document).on("click",".js_show_btn",function(){
                $(".p10_box").fadeIn(200);
            });
            // 关闭查看框
            $(".js_close_btn").on("click",function(){
                $(".p10_box").fadeOut(200);
            });
            // 点击查看对应详情
            $(".js_detail_btn").on("click",function(){
                var src=$(this).attr("data-src")?$(this).attr("data-src"):"";
                var type=$(this).attr("data-type")?$(this).attr("data-type"):1;
                if(src!=""){
                    if(type==1){
                        $(".js_close_window").addClass("btn1").removeClass("btn2");
                    }else{
                        $(".js_close_window").addClass("btn2").removeClass("btn1");
                    }
                    $("#iframe_ele").attr("src",src);
                    $(".p10_box").fadeOut(200);
                    $("#iframe_window").fadeIn(200);
                }
            });
            // 关闭查看窗口
            $(".js_close_window").on("click",function(){
                $("#iframe_window").fadeOut(200);
            });
            //调整布局
            $(window).resize(function(){$m.rs()});
        });
        function toSub(obj){
            var txt=$(".txt_area").val();
            if(txt=="" || txt==undefined){
                $("#atten_txt").text("请填写问题内容！");
                $("#atten_box").fadeIn(200,function(){
                    $("#atten_box").delay(500).fadeOut(500);
                });
            }else{
                return_arr["content"]=txt;
                // 可提交
                obj.off("click").text("提交中...");
                $.ajax({
                    type: "POST",
                    url: ajax_link+"ajax_messageboard_save",
                    data: return_arr,
                    dataType: "json",
                    success: function(){
                        $("#atten_txt").text("提交成功！");
                        $("#atten_box").fadeIn(200,function(){
                            $("#atten_box").delay(500).fadeOut(500);
                        });
                        obj.on("click",function(){
                            toSub($(this));
                        }).text("提交问题");
                        $(".txt_area").val("");
                    },
                    error: function(){
                        $("#atten_txt").text("提交失败！请重试。");
                        $("#atten_box").fadeIn(200,function(){
                            $("#atten_box").delay(500).fadeOut(500);
                        });
                        obj.on("click",function(){
                            toSub($(this));
                        }).text("提交问题");
                        $(".txt_area").val("");
                    }
                });
            }
        }
        // 微信静禁止分享
        function onBridgeReady(){
            WeixinJSBridge.call('hideOptionMenu');
        }
        // 请求数据
        function getDom(){
            $.ajax({
                type: "POST",
                url: $m.ajax_link,
                data: {'userid':userid,'rt_type':10},
                dataType: "json",
                success: function(data){
                    console.log(data);
                    $m.data_arr=data;
                    setDom(data);
                },
                error: function(XMLHttpRequest,textStatus,errorThrown){
                    $(".p6_content").hide();
                    $(".p6_atten").show();
                    $(".p6_add_div").show();
                }
            });
        }
        // 生成dom
        function setDom(data){
            console.log(data);
            var arr=data;
            var len=arr.length;
            if(len>0){
                var _html='';
                var area_arr=[];
                for(var i=0;i<len;i++){
                    var area=arr[i]["area"]?arr[i]["area"]:"";
                    var is_exist=false;
                    for(var j=0,len1=area_arr.length;j<len1;j++){
                        var this_area=area_arr[j]?area_arr[j]:"";
                        if(this_area==area){
                            is_exist=true;
                            break;
                        }
                    }
                    if(!is_exist){
                        area_arr.push(area);
                    }
                }
                // 生成区域选项
                if(area_arr.length>0){
                    nSearch.setSelct($(".js_select1"),area_arr);
                    var txt=$(".js_select1").val()?$(".js_select1").val():"";
                    if(txt!=""){
                        var narr=nSearch.searchFunc([{"area":txt}],arr);
                        console.log(narr);
                    }
                    
                }
            }else{
                $(".p10_list").html("");
                $(".js_no_person").show("");
            }
            myScroll.refresh();
        }
        // 生成区域
        function setSelect1(obj,arr){
            var _html='<option disabled value="请选择">请选择</option>';
            for(var i=0,len=arr.length;i<len;i++){
                var txt=arr[i];
                _html+='<option value="'+txt+'">'+txt+'</option>';
            }
            obj.html(_html);
        }
        // 查找对象
        function searchFunc(options,arr,tar){
            for(var i=0,len=arr.length;i<len;i++){
                var txt=arr[i];
                _html+='<option value="'+txt+'">'+txt+'</option>';
            }
        }
        // n级联动
        function selMethod(){
            // set-time 2016-04-07
            // author lut

        }
        selMethod.prototype={
            setSelct:function(obj,arr){           //生成dom
                var _html='<option disabled value="请选择">请选择</option>';
                for(var i=0,len=arr.length;i<len;i++){
                    var txt=arr[i];
                    _html+='<option value="'+txt+'">'+txt+'</option>';
                }
                obj.html(_html);
            },
            searchFunc:function(options,arr){     //处理搜索数据
                var narr=[];
                if(options && options.length){
                    if(arr && arr.length){
                        var narr=[];
                        for(var i=0,len=options.length;i<len;i++){
                            var txt="";
                            var nkey="";
                            for(var key in options[i]){
                                txt=options[i][key];
                                nkey=key;
                            }
                            sonFunc(narr,txt,nkey);
                        }
                        function sonFunc(this_arr,ntxt,tkey){
                            for(var j=0,len1=arr.length;j<len1;j++){
                                var name=arr[j][tkey];
                                if(ntxt==name){
                                    this_arr.push(arr[j]);
                                }
                            }
                            return this_arr;
                        }
                    } 
                }
                return narr;
            },
            
        }
    </script>
</body>
</html>