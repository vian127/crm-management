<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <meta name="author" content="we"/>
        <meta name="keywords" content="毛戈平,整点抢券"/>
        <meta name="description" content="关注MGPIN官方微信，参与微信整点抢礼券活动"/>
        <meta name="format-detection" content="telephone=no"/>
        <meta name="viewport" content="initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
        <title>MGPIN</title>
        <link rel="stylesheet" href="css/main.css"/>
        <script type="text/javascript" src="js/jquery-2.1.4.min.js"></script>
    </head>
    <body>
        <!-- 模拟屏幕 -->
        <section id="container">
            <!-- 首页 -->
            <div class="page page1">
                <div class="scroll">
                    <!-- 头部 -->
                    <div class="header">
                        <h3 class="tit">
                            <img src="images/tit1.png" alt="幸运整点抢券">
                            <p>活动时间:2016.4.5-5.5期间（每周一到周四）</p>
                            <span>10点</span>
                            <span>14点</span>
                            <span>20点</span>
                            <div class="clear p1_btn_div">
                                <!-- 查看优惠券 -->
                                <a class="btn3 f_l" href="my_coupon.html" title="查看优惠券">查看优惠券</a>
                                <!-- 规则按钮 -->
                                <a class="btn3 js_rule_btn f_r" href="javascript:;" title="活动规则">活动规则</a>
                            </div>
                        </h3>
                    </div>
                    <!-- 中间 -->
                    <div class="content">
                        <!-- 展示钟表 -->
                        <div class="p1_div1">
                            <img class="top_pic" src="images/1.jpg" alt="钟表"/>
                            <a class="btn3 btn_type1 js_sub" href="javascript:;" title="点击抢券"><img class="top_pic" src="images/btn1.png" alt="点击抢券"/><span class="animate1">点击<br/>抢券</span></a>
                        </div>
                        <!-- 倒计时 -->
                        <div class="p1_div2">
                            <!-- 后台时间 -->
                            <input id="date" type="hidden" value="2016-03-29 10:00:55">
                            <input id="stock" type="hidden" value="2">
                            <p class="js_status_txt">距离活动开始还有：</p>
                            <ul class="time_list">
                                <li><div><img class="js_time_pic" src="images/0.png" alt="0"></div><div><img class="js_time_pic" src="images/0.png" alt="0"></div>
                                </li>
                                <li><div><img class="js_time_pic" src="images/0.png" alt="0"></div><div><img class="js_time_pic" src="images/0.png" alt="0"></div>
                                </li>
                                <li><div><img class="js_time_pic" src="images/0.png" alt="0"></div><div><img class="js_time_pic" src="images/0.png" alt="0"></div>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <!-- 底部 -->
                    <div class="footer">
                        <h3>优惠券包含</h3>
                        <ul>
                            <li><span class="spn1">&nbsp;</span>价值<span class="font15 fw_b color3">80元</span>品牌节日代金劵(满799抵用）</li>
                            <li><span class="spn1">&nbsp;</span>价值<span class="font15 fw_b color3">20元</span>品牌代金劵：限购气垫霜套装抵用</li>
                            <li><span class="spn1">&nbsp;</span><span class="font12 fw_b color3">礼品券</span>：奢华活氧动能水10ml一瓶</li>
                        </ul>
                    </div>
                </div>
            </div>
            <!-- 规则 -->
            <div class="page page2">
                <div class="scroll">
                    <div class="header">
                        <h3 class="tit">
                            活动规则
                        </h3>
                    </div>
                    <div class="content">
                        <div class="rule_div">
                            <p><label>活动时间：</label>2016.4.5-5.5期间逢（周一到周四）；</p>
                            <p><label>参与方式：</label>关注MGPIN官方微信，即可参与微信整点抢礼券活动；</p>
                            <p><label>抢卷时间：</label>每天10点，14点，20点，礼卷限量，抢完即止；</p>
                            <p><label>礼券包含：</label>
                                <ul>
                                    <li><label>1、通用抵用券：</label>价值80元品牌节日代金劵(满799抵用）</li>
                                    <li><label>2、指定商品抵用券：</label>价值20元品牌代金劵：限购气垫霜套装抵用</li>
                                    <li><label>3、中小样申领券：</label>礼品券：奢华活氧动能水10ml一瓶</li>
                                    <li><label>1、通用抵用券：</label>价值80元品牌节日代金劵(满799抵用）</li>
                                    <li><label>1、通用抵用券：</label>价值80元品牌节日代金劵(满799抵用）</li>
                                </ul>
                            </p>
                            <p><label>礼券使用时间：</label>2016.5.1-5.10</p>
                        </div>
                    </div>
                </div>
                <!-- 规则关闭 -->
                <a class="btn2 js_close_btn" href="javascript:;" title="关闭规则"><img src="images/icon1.png" alt="关闭规则"/></a>
            </div>
            <!-- 背景 -->
            <div class="bg_div"></div>
        </section>
        <!-- 提示信息 -->
        <section id="atten_box" class="center_box">
            <div class="top_div"></div>
            <p class="p1">
                <span class="type3"></span>
            </p>
            <p class="p2"><a class="btn3" href="javascript:window.location.reload(true);" title="重新加载页面">加载失败，点击重试！</a></p>
            <p class="p3">对不起，<br> 本次活动已经结束了，<br>请继续关注毛戈平的其他活动。</p>
        </section>
        <section id="bg_div" class="center_box"></section>
        <script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
        <script type="text/javascript" src="js/frame.js"></script>
        <script type="text/javascript" src="js/iscroll.js"></script>
        <script type="text/javascript">
            // 定义滚动
            var myScroll1 = new IScroll('.page1',{mouseWheel: true,hideScrollbar: false,click: true});
            var myScroll2 = new IScroll('.page2',{mouseWheel: true,hideScrollbar: false,click: true});
            // 自定义方法
            var $m={
                // 分享链接
                share_href: encodeURI(window.location.href),
                // 图片地址前缀
                img_url:"images/",
                // 重新布局
                rs: function(){
                    var limit=720;
                    var dw=document.documentElement.clientWidth;
                    var dh=document.documentElement.clientHeight;
                    var fw=dw>limit?limit:dw;
                    $("body").css({"font-size":1*fw/360+"em"});
                    var ratio=1;
                    if(dh/fw*720<1136){
                        ratio=dh/fw*720/1136;
                    }
                    if(dw>limit){
                        $(".center_box").css({"left":(dw-limit)/2+"px"});
                    };
                    // $(".tit>img").width(50*ratio+"%");
                    myScroll1.refresh();
                    myScroll2.refresh();
                },
                // 居中显示
                toCenter:function(obj,par){
                    var dh=par.height();
                    var oh=obj.outerHeight();
                    obj.css({"margin-top": (dh-oh)/2-50+"px"});
                },
            }
            var ntime=null;              //倒计时对象
            $(function(){
                // 绑定滚动
                $m.rs();
                $("#atten_box").fadeOut(200,function(){
                });
                //设置按钮颜色
                m.setcss({"butbg":"#e60a4b"});
                // 实例化倒计时
                var n_date=$("#date").val()?$("#date").val():new Date();
                ntime=new countDown(n_date);
                ntime.init();
                // 查看活动规则
                $(".js_rule_btn").on("click",function(){
                    $(".page2").fadeIn(200,function(){
                        myScroll2.refresh();
                    });
                    $(".bg_div").fadeIn(400);
                });
                // 关闭规则
                $(".js_close_btn").on("click",function(){
                    $(".page2").fadeOut(200,function(){
                        myScroll1.refresh();
                    });
                    $(".bg_div").fadeOut(400);
                });
                // 点击抢券
                $(".js_sub").on("click",function(){
                    subFunc($(this));
                });
                $(window).on("resize",function(){$m.rs()});
            });
// 倒计时
function countDown(date){
    this.ndate  =new Date(date);        //当前服务器时间
    this.ntimes =this.ndate.getTime();  //当前服务器时间长
    this.start_t="2016-4-5";            //开始日期
    this.end_t  ="2016-5-5 23:59:59";            //结束日期
    this.begin_t=["10:00","14:00","20:00"];            //开抢时间点
    this.time_spot=[];
    this.length_t=5*60*1000;                 //开抢时长 单位毫秒
    this.day="1,2,3,4";                 //活动具体星期
    this.status=null;                   //当前时间的活动状态   1=没有到日子，2=星期没对应，3=没到时间点，4=活动过期了，5=正在开抢中；以上几个状态依次判断来
    this.timer=null;                    //计时器
    this.change_txt1=true;               //是否需要修改dom
    this.change_txt2=true;               //是否需要修改dom
}
countDown.prototype={
    init:function(){                 //初始化数据
        var a=this;
        a.start_t=a.getTimes(a.start_t);
        a.end_t=a.getTimes(a.end_t);
        var ny=a.ndate.getFullYear();
        var nm=a.ndate.getMonth()+1;
        var nd=a.ndate.getDate();
        var str=ny+"-"+nm+"-"+nd;
        for(var i=0,len=a.begin_t.length;i<len;i++){
            var times=a.getTimes(str+" "+a.begin_t[i]+":00");
            a.time_spot.push(times);
        }
        // 先执行一次
        // var arr=a.getStatus();
        // arr=arr.length==0?[0,0,0]:arr;
        // setDom(a.status,arr);
        // 开始计时
        a.timer=setInterval(function(){
            var arr=a.getStatus();
            arr=arr.length==0?[0,0,0]:arr;
            setDom(a.status,arr);
            a.ntimes+=1000;
        },1000);
    },
    getTimes:function(str){          //转换时间
        var date=new Date(str);
        var times=date.getTime();
        return times;
    },
    getStatus:function(){
        var a=this;
        var ntimes=a.ntimes;          //当前总ms
        var nday=a.ndate.getDay();             //当前星期
        var nh=a.ndate.getHours();             //当前时间点
        var times_num=0;                     //时间差 s
        var return_arr=[];                   //返回数据
        if(ntimes<a.start_t){
            // 没有到开抢的日期
            a.status=1;
        }else if(ntimes<a.end_t){
            // 1=没有到日子，2=星期没对应，3=没到时间点，4=活动过期了，5=正在开抢中；以上几个状态依次判断来
            if(a.day.indexOf(nday)!=-1){
                //在抢的星期
                if((a.time_spot[0]<=ntimes && a.time_spot[0]+a.length_t>=ntimes) || (a.time_spot[1]<=ntimes && a.time_spot[1]+a.length_t>=ntimes) || (a.time_spot[2]<=ntimes && a.time_spot[2]+a.length_t>=ntimes)){
                    // 在抢时间段内
                    a.status=5;
                }else{
                    a.status=3;
                    if(a.time_spot[0]>ntimes){
                        // 未到8点
                        times_num=(a.time_spot[0]-ntimes)/1000;
                        var h=Math.floor(times_num/3600)
                        var m=Math.floor((times_num-h*3600)/60);
                        var s=Math.floor(times_num-h*3600-m*60);
                        return_arr=[h,m,s];
                        // setDom(a.status,return_arr);
                    }else if(a.time_spot[1]>ntimes){
                        // 未到14点
                        times_num=(a.time_spot[1]-ntimes)/1000;
                        var h=Math.floor(times_num/3600)
                        var m=Math.floor((times_num-h*3600)/60);
                        var s=Math.floor(times_num-h*3600-m*60);
                        return_arr=[h,m,s];
                        // setDom(a.status,return_arr);
                    }else if(a.time_spot[2]>ntimes){
                        // 未到20点
                        times_num=(a.time_spot[2]-ntimes)/1000;
                        var h=Math.floor(times_num/3600)
                        var m=Math.floor((times_num-h*3600)/60);
                        var s=Math.floor(times_num-h*3600-m*60);
                        return_arr=[h,m,s];
                        // setDom(a.status,return_arr);
                    }else{
                        // 过了20点
                        var ny=a.ndate.getFullYear();
                        var nm=a.ndate.getMonth()+1;
                        var nd=a.ndate.getDate();
                        var str="";
                        var td=null;
                        if(nday==4){
                            // 周四晚上
                            if(nd==28){
                                nm+=1;
                                nd=1;
                            }else{
                                nd+=4;
                            }
                        }else{
                            // 4月判断
                            nd+=1;
                        }
                        str=ny+"-"+nm+"-"+nd+" "+a.begin_t[0]+":00";
                        td=new Date(str);
                        times_num=(td.getTime()-ntimes)/1000;
                        var h=Math.floor(times_num/3600)
                        var m=Math.floor((times_num-h*3600)/60);
                        var s=Math.floor(times_num-h*3600-m*60);
                        return_arr=[h,m,s];
                        // setDom(a.status,return_arr);
                    }
                }
            }else{
                // 不在抢的星期
                a.status=2
            }
        }else{
            // 已经过期了
            a.status=4;
        }
        return return_arr;
    },
    toDouble:function(num){                   // 加双
        num=parseInt(num)?parseInt(num):0;
        num=num<10?"0"+num:num;
        return num;
    }
}
// 显示dom
function setDom(status,arr){
    // 1=没有到日子，2=星期没对应，3=没到时间点，4=活动过期了，5=正在开抢中；以上几个状态依次判断来
    if(status==1 || status==2 || status==4){
        // 不能抢不必计时了
        clearInterval(ntime.timer);
    }else if(status==3){
        // 没开始，倒计时
        if(ntime.change_txt1){
            ntime.change_txt2=true;
            ntime.change_txt1=false;
            $(".js_status_txt").text("距离活动开始还有：");
        }
    }else if(status==5){
        // 开始抢中
        if(ntime.change_txt2){
            ntime.change_txt1=true;
            ntime.change_txt2=false;
            $(".js_status_txt").text("活动已经开始，赶快点击抢券！");
        }
    }
    var t_arr=[];
    for(var i=0,len=arr.length;i<len;i++){
        if(arr[i]<10){
            t_arr.push(0);
            t_arr.push(arr[i]);
        }else{
            var str=arr[i].toString();
            t_arr.push(str.substr(0,1));
            t_arr.push(str.substr(1,1));
        }
    }
    for(var j=0,len=t_arr.length;j<len;j++){
        $(".js_time_pic").eq(j).attr("src",$m.img_url+t_arr[j]+".png");
    }
}
// 点击抢券
function subFunc(obj){
    var status=ntime.status;
        // 已申领
        if(status==1 || status==4){
            msg("活动时间为4月5日至5月5日期间！","我知道了");
        }else if(status==2){
            msg("<h3>还没有到抢券时间哦！</h3><p class='font08' style='margin-bottom:1em;margin-top:0.3em'>抢券时间为：每周一到周四</p><span class='color4 font12 fw_b'>10:00</span><br/><span class='color4 font12 fw_b'>14:00</span><br/><span class='color4 font12 fw_b'>20:00</span>","我知道了");
        }else if(status==3){
            msg("<p class='fw_b' style='line-height:1.5em'>请于<br/>10:00、14:00、20:00<br/>准时抢券</p>","我知道了");
        }else if(status==5){
            // 可以抢券
            var stock=$("#stock").val()?$("#stock").val():1;
            if(stock==1){
                // 有库存
                obj.off("click");
                obj.children("span").removeClass("animate1").html("正在<br/>出券").css({"color":"#555"});
                // 后台判断是否抢中   假设返回字段是 return_data;
                var return_data=2;
                if(return_data==1){
                    // 成功
                    window.location.href="success.html";
                }else if(return_data==2){
                    // 没抢到
                    msg("<p class='fw_b' style='line-height:1.5em'>很遗憾！<br/>您没有中奖，<br/>在下一个时间段再接再厉吧！</p>","我知道了",function(){
                        obj.children("span").addClass("animate1").html("点击<br/>抢券").css({"color":"#b42a49"});
                        obj.on("click",function(){
                            subFunc($(this));
                        });
                    },true);
                }
            }else{
                // 没有库存
                msg("<p class='fw_b' style='line-height:1.5em'>本时段所有礼券<br/>已经全部抢光了！<br/>下个时间段再试试哦！</p>","我知道了");
            }
        }
}
/*----------------微信分享-----------------*/
// 分享函数
function shareFunc(arr){
    wx.config({
        debug: false,
        appId: arr["appid"], 
        timestamp: arr["timestamp"], 
        nonceStr: arr["nonceStr"], 
        signature: arr["signature"], 
        jsApiList:[
            'checkJsApi',
            'onMenuShareTimeline',
            'onMenuShareAppMessage',
            'hideMenuItems',
        ] 
    });
    wx.ready(function(){

        wx.onMenuShareTimeline({
            title: '#兰芝2016明星礼赠#快来领取最受欢迎的兰芝明星产品四件套~', // 分享标题
            link: "http://cdn.wemediacn.com/webpage_laneige/api/CoverService.aspx?r_url=http://weapp.wemediacn.com/laneige/applyinfo/201603/index.html", // 分享链接
            imgUrl: "http://bos.bj.baidubce.com/we-sh2/laneige/applyinfo/yun/201603/images/share.jpg", // 分享图标
            success: function () { 
                // 用户确认分享后执行的回调函数
            },
            cancel: function () { 
                // 用户取消分享后执行的回调函数
            }
        });
        wx.onMenuShareAppMessage({
            title: '#兰芝2016明星礼赠#快来领取最受欢迎的兰芝明星产品四件套~', // 分享标题
            desc: '#兰芝2016明星礼赠#快来领取最受欢迎的兰芝明星产品四件套~', // 分享描述
            link: "http://cdn.wemediacn.com/webpage_laneige/api/CoverService.aspx?r_url=http://weapp.wemediacn.com/laneige/applyinfo/201603/index.html", // 分享链接
            imgUrl: "http://bos.bj.baidubce.com/we-sh2/laneige/applyinfo/yun/201603/images/share.jpg", // 分享图标
            type: 'link', // 分享类型,music、video或link，不填默认为link
            dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
            success: function () { 
                // 用户确认分享后执行的回调函数
            },
            cancel: function () { 
                // 用户取消分享后执行的回调函数
            }
        });
        // 隐藏按钮
        wx.hideMenuItems({
            menuList: [
                'menuItem:readMode', // 阅读模式
                'menuItem:copyUrl' ,// 复制链接
                'menuItem:share:qq',//分享qq
                'menuItem:share:weiboApp',//分享微博
                'menuItem:share:facebook',//分享到FB
                'menuItem:jsDebug',//调试
                'menuItem:editTag',//编辑标签
                'menuItem:delete',//删除
                'menuItem:originPage',//原网页
                'menuItem:openWithQQBrowser',//qq浏览器打开
                'menuItem:openWithSafari',//safari浏览器打开
                'menuItem:share:email',//邮件
                'menuItem:share:brand',//特殊公众号
            ],
            success: function (res) {
                console.log("ok");
            },
            fail: function (res) {
                console.log(JSON.stringify(res));
            }
        });
    });
}
        </script>
    </body>
   
</html>

 